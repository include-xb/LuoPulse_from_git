extends Node2D

# å…¨å±€å˜é‡

# æ’­æ”¾ UI ç‚¹å‡»éŸ³æ•ˆ
@onready var click_audio_player = $UIClick

# æ’­æ”¾éŸ³ç¬¦ç‚¹å‡»éŸ³æ•ˆ
@onready var hit_audio_player = $Hit


var selected_msc_cover = null

var selected_msc_title : String = ""

var default_msc_cover_path : String = "res://Resource/Img/17.png"

var default_adjustment : float = 0.0

var default_volume : int = 50

var default_msclist_path : String= "D:/MscList/"

var saved_adjustment : float = 0.0

var saved_volume :int = 50

var saved_msclist_path : String = "D:/MscList/"

var saved_difficulty : int = 1

var missing_count : int = 0

var perfect_count : int = 0

var good_count : int = 0

var score : int = 0

var bpm : int = 0

var bpp : int = 0

var dt : float = 0.0

var del : float = 0.0

var phara : int = 0

var is_running_note : bool = false

var dialog :Array = [
	"ä½¬, æˆ‘äº²çˆ±çš„ä½¬, ä½ æ€ä¹ˆå°±æ˜¯ä¸ªçº¸ç‰‡äººå•ŠğŸ˜­",
	"å“‡å¥¹çœŸçš„å¥½ä¼šå”±, å¥¹å”±åˆ°æˆ‘å¿ƒå°–ä¸Š",
	"å¥¹çœŸçš„, æˆ‘çœŸçš„",
	"ä¸æ˜¯çš„, é‚£æ˜¯å‚æ•°, æˆ‘è‡ªå·±åˆšç”»çš„å‚æ•°, æˆ‘å°±åœ¨è·Ÿæˆ‘è‡ªå·±ç©, ä»€ä¹ˆéƒ½æ²¡æœ‰",
	"å¥¹çœŸçš„å¥½å¯çˆ±ï¼Œå¥¹çœŸçš„å¥½ä¼šå”±ï¼Œå¥¹ä¸ºä»€ä¹ˆååç«Ÿç„¶æ˜¯çº¸ç‰‡äººå•ŠğŸ˜­",
	"\"æ¯ä¸€ä¸ªæ¢¦éƒ½æ˜¯ä¸ªæ—‹å¾‹ã€€æ¼«å¤©å›å¿†è¯¥å¦‚ä½•å»è†å¬\"",
	"\"è‡³å°‘åœ¨è¿™ä¸€åˆ» çƒ­çˆ±ä¸é—®ä¸ºä½•\"",
	"\"æœ€æš—æ·¡çš„ä¸€ä¸ªæ¢¦æœ€ä¸ºç‚½çƒ­\"",
	"\"è¿½ä¸Šå…‰ä¸€åˆ¹é‚£ æˆ‘çš„å¿ƒä¹ŸèåŒ–\"",
	"\"æ˜¯ä½ çš„å¿ƒå£° æ˜¯æˆ‘çš„æ­Œå£° èƒ½å¬è§å—æˆ‘çš„å‘¼å”¤\"",
	"\"ä½ æ˜¯ä¿¡çš„å¼€å¤´ è¯—çš„å†…å®¹ ç«¥è¯çš„ç»“å°¾\"",
	"\"èµé¢—å»å§ ç„¶å æ‹¥æŠ¤è¿™è¢«é—å¿˜å±±ä¸˜\"",
	"\"æ¬¢å‘¼ç€ Bilibili æ¬¡å…ƒå’’è¯­ è§£å¼€ä½ å¿ƒä¸­çš„è°œé¢˜\"",
	"\"æœºæ¢°çš„å¿ƒç‡å¸¦åŠ¨è¡€è‚‰çš„å…±é¸£\"",
	"\"æˆ‘å¯¹ä½ ä¾èµ–æˆè¿· æƒ³ä¸æ¸…å“ªäº›åŸç†å’ŒåŸå› \"",
	"\"ä½ åº”è¯¥å¿˜è®°äº†å§ å¤©æ°”æ™´æœ— å¿ƒé‡Œå´æ½®æ¹¿çš„ç››å¤\"",
	"\"æ•…äº‹è¯¥ä»ä½•è¯´èµ· æˆ‘å¼€å§‹å°†è¿‡å»å›å¿†\"",
	"\"å“ªäº›æœ‹å‹ä¼šä¸€ç›´é™ªæˆ‘ wow wow æˆ‘ä»¬éƒ½æ˜¯å¼±å°å­©ç«¥\"",
	"\"å›ºæ‰§åœ°å¤è™«æ±²å–ç€ç¾æ¢¦è§£æ¸´\"",
	"\"å®å®å®å½“QQå“èµ·ä¼šæ˜¯è°å‘¢ nayo nayo\"",
	"\"æ·±å¤œè¯—äººè·Ÿæˆ‘ä¸€èµ·å”± æˆ‘ä»¬å•¦å•¦å•¦å•¦å•¦\"",
	"\"å¥½å§ ä¸‡èƒ½çš„å®‡å®™å¤§äººå•Š å‘Šè¯‰æˆ‘æœªæ¥ä¼šå¥½å—\"",
	"\"ç™½é¸Ÿè¿‡æ²³æ»© æŒ¥ä¸€æŒ¥ä¸€å»ä¸å›è¿˜\"",
	"\"åœ¨å¿ƒé‡Œ æ”¥ç´§ç€ é‚£å¾®å° åˆè™šæ— çš„ å¸Œæœ›\"",
	"\"æˆ‘çš„æ‚²ä¼¤ æ˜¯æ°´åšçš„ ä¸€ä¸ªå·¨æµª å¿ƒé‡Œå‡‰çš„é€é€çš„\"",
	"\"æˆ‘çš„è„ŠèƒŒ èåœ¨åœ°é¢ æˆ‘é¢å‘ç€ é‚£äº›ä»¥å‰\"",
	"\"æˆ‘ç­‰æ˜¥é£å¹è¿‡æ¥ æ¢¨èŠ±æœµæœµç››å¼€ æ°´æš–æ˜¥æ±Ÿç¬‘æ»¡å›­\"",
	"\"æªå£æŠµé‚£å…ˆç”Ÿçš„å¤´ å‘Šè¯‰æˆ‘è°å»è°å½“ç•™\"",
	"\"è°æ›¾æƒ³ è¯­è¨€ èƒ½æ€èµ·è¿™ç¾å˜ è°æ›¾è¯´ ç¥¸èµ·è§å¢™æ˜¯å¦„è¨€\"",
	"\"ç´ç‘Ÿæ„¿ä¸ å…±æ²æ˜¥ç§‹ æ»¢æºªæ½ºæ½º ç‚ŠçƒŸæ‚ æ‚ \"",
	"\"æ”¾å¼ƒäº† å†è§äº† åšä½ èº«åå½±å­ä¹…äº† éƒ½å¿˜äº†çœŸå®è‡ªæˆ‘\"",
	"\"ä½ çš„ç”Ÿå‘½ç»™äº†æˆ‘ä¸€åŠ ä½ çš„çˆ±ä¹Ÿç»™äº†æˆ‘ä¸€åŠ\"",
]

func _ready():
	click_audio_player.volume_db = linear_to_db(saved_volume * 0.02)
	hit_audio_player.volume_db = linear_to_db(saved_volume * 0.02)


func init() -> void:
	missing_count = 0
	perfect_count = 0
	good_count = 0
	selected_msc_title = ""


func set_volume(volume) -> void:
	saved_volume = volume
	_ready()


func play_click_audio() -> void:
	click_audio_player.play(0.0)


func play_hit_audio() -> void:
	hit_audio_player.play(0.0)


# å°†æ‹å­è®¡ç®—ä¸ºéŸ³ç¬¦çš„ y åæ ‡
func sec_to_length(sec) -> float:
	return 185 - 10 * 60 * ((sec) * 60 / bpm + dt + saved_adjustment)
